# ãƒ¡ãƒ‡ã‚£æ§˜ã‚·ãƒ•ãƒˆä½œæˆãƒ„ãƒ¼ãƒ« - èªè¨¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### èƒŒæ™¯
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: ãƒ¡ãƒ‡ã‚£æ§˜å°‚ç”¨ã‚·ãƒ•ãƒˆä½œæˆãƒ„ãƒ¼ãƒ«
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: Next.js 14 + TypeScript + Tailwind CSS + Supabase
- **ç¾çŠ¶**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å®Œæˆã€èªè¨¼ã‚·ã‚¹ãƒ†ãƒ æœªå®Ÿè£…
- **ç›®çš„**: åŒ»ç™‚æ©Ÿé–¢å‘ã‘AIæ´»ç”¨ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

### ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³
**å®Œæˆæ¸ˆã¿ï¼ˆ8ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰:**
1. `components/MainLayout.tsx` - ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
2. `components/DataInputPage.tsx` - ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒšãƒ¼ã‚¸
3. `components/EmployeePage.tsx` - å¾“æ¥­å“¡ç®¡ç†
4. `components/WorkplacePage.tsx` - é…ç½®å ´æ‰€ç®¡ç†
5. `components/ShiftPatternPage.tsx` - ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†
6. `components/LeavePage.tsx` - å¸Œæœ›ä¼‘ç®¡ç†
7. `components/ConstraintsPage.tsx` - AIåˆ¶ç´„æ¡ä»¶ç®¡ç†
8. `components/ShiftPage.tsx` - ã‚·ãƒ•ãƒˆè¡¨ç¤º

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«:**
- package.json, tsconfig.json, tailwind.config.js, next.config.js
- .eslintrc.json, postcss.config.js, app/globals.css
- app/layout.tsx, app/page.tsx, types/index.ts

## èªè¨¼ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¨®åˆ¥ãƒ»æ¨©é™
1. **ç®¡ç†è€…** (`admin`)
   - å…¨æ©Ÿèƒ½ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - ã‚·ãƒ•ãƒˆä½œæˆãƒ»ç·¨é›†ãƒ»å¾“æ¥­å“¡ç®¡ç†

2. **å¾“æ¥­å“¡** (`employee`)
   - å¸Œæœ›ä¼‘ç”³è«‹ï¼ˆè‡ªåˆ†ã®åˆ†ã®ã¿ï¼‰
   - ã‚·ãƒ•ãƒˆé–²è¦§ï¼ˆå…¨ä½“è¡¨ç¤ºï¼‰
   - ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ãƒšãƒ¼ã‚¸: å¾“æ¥­å“¡ç®¡ç†ã€é…ç½®å ´æ‰€ç®¡ç†ã€ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†ã€AIåˆ¶ç´„æ¡ä»¶ç®¡ç†

3. **é–‹ç™ºä¼šç¤¾** (`developer`)
   - ç®¡ç†è€…ã¨åŒã˜æ¨©é™

### èªè¨¼ä»•æ§˜
- **ãƒ­ã‚°ã‚¤ãƒ³å½¢å¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆå°æ–‡å­—ãƒ­ãƒ¼ãƒå­—5æ–‡å­—+æ•°å­—3æ¡ï¼‰ + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆåŒå½¢å¼ï¼‰
- **ä¾‹**: `tanaka123` / `yamada456`
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“**: 1æ™‚é–“
- **ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ä¿æŒ**: ãƒã‚§ãƒƒã‚¯æ™‚2é€±é–“
- **å¤±æ•—åˆ¶é™**: ãªã—
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: é€šå¸¸èªè¨¼ã®ã¿

### UI/UXä»•æ§˜
- **ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸**: ã‚·ãƒ³ãƒ—ãƒ«ã€ãƒ­ã‚´ãƒ»æ–½è¨­åãªã—
- **ãƒ­ã‚°ã‚¤ãƒ³å¾Œé·ç§»**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ ã‚·ãƒ•ãƒˆä½œæˆãƒšãƒ¼ã‚¸ï¼ˆDataInputPageï¼‰
- **ãƒ‡ã‚¶ã‚¤ãƒ³**: æ—¢å­˜ã®ç®¡ç†ç”»é¢ã¨çµ±ä¸€æ„Ÿ
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–**: ã‚¹ãƒãƒ›å¯¾å¿œå¿…é ˆ

### å°†æ¥æ‹¡å¼µæ€§
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œæº–å‚™ï¼ˆè¤‡æ•°ã‚¯ãƒªãƒ‹ãƒƒã‚¯å¯¾å¿œï¼‰
- ç¾åœ¨ã¯å˜ä¸€æ–½è¨­ã€å°†æ¥çš„ã«ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³æ–¹å¼ã¸ç§»è¡Œå¯èƒ½

## å®Ÿè£…ã‚¿ã‚¹ã‚¯

### Phase 1: æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

#### 1. èªè¨¼é–¢é€£å‹å®šç¾©
**ãƒ•ã‚¡ã‚¤ãƒ«**: `types/auth.ts`
```typescript
export type UserRole = 'admin' | 'employee' | 'developer'

export interface User {
  id: string
  user_id: string        // tanaka123 å½¢å¼
  name: string
  role: UserRole
  created_at: string
  last_login?: string
}

export interface LoginCredentials {
  user_id: string
  password: string
  remember_me: boolean
}

export interface AuthState {
  user: User | null
  isLoading: boolean
  isAuthenticated: boolean
}

export interface SessionData {
  user: User
  expires_at: number
  remember_me: boolean
}
```

#### 2. èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯
**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/auth.ts`
```typescript
import { LoginCredentials, User } from '@/types/auth'

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
export function validateUserId(userId: string): boolean {
  // å°æ–‡å­—ãƒ­ãƒ¼ãƒå­—5æ–‡å­—+æ•°å­—3æ¡
  const regex = /^[a-z]{5}[0-9]{3}$/
  return regex.test(userId)
}

export function validatePassword(password: string): boolean {
  // åŒã˜å½¢å¼
  return validateUserId(password)
}

// èªè¨¼é–¢æ•°ï¼ˆç¾åœ¨ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼‰
export async function authenticate(credentials: LoginCredentials): Promise<User | null> {
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  if (!validateUserId(credentials.user_id) || !validatePassword(credentials.password)) {
    throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
  }

  // ãƒ¢ãƒƒã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿè£…æ™‚ã¯Supabaseæ¥ç¶šï¼‰
  const mockUsers: User[] = [
    {
      id: '1',
      user_id: 'admin123',
      name: 'ç®¡ç†è€…',
      role: 'admin',
      created_at: '2025-01-01T00:00:00Z'
    },
    {
      id: '2', 
      user_id: 'nurse456',
      name: 'çœ‹è­·å¸«A',
      role: 'employee',
      created_at: '2025-01-01T00:00:00Z'
    },
    {
      id: '3',
      user_id: 'devel789',
      name: 'é–‹ç™ºè€…',
      role: 'developer', 
      created_at: '2025-01-01T00:00:00Z'
    }
  ]

  // ãƒ¢ãƒƒã‚¯èªè¨¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒåŒã˜å ´åˆã«æˆåŠŸï¼‰
  const user = mockUsers.find(u => u.user_id === credentials.user_id)
  if (user && credentials.user_id === credentials.password) {
    return user
  }

  throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
}

// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
export async function logout(): Promise<void> {
  // TODO: å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ï¼ˆSupabaseå®Ÿè£…æ™‚ï¼‰
  console.log('Logout called')
}
```

#### 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/session.ts`
```typescript
import { User, SessionData } from '@/types/auth'

const SESSION_DURATION = 60 * 60 * 1000        // 1æ™‚é–“
const REMEMBER_DURATION = 14 * 24 * 60 * 60 * 1000  // 2é€±é–“

export function createSession(user: User, rememberMe: boolean): SessionData {
  const duration = rememberMe ? REMEMBER_DURATION : SESSION_DURATION
  
  return {
    user,
    expires_at: Date.now() + duration,
    remember_me: rememberMe
  }
}

export function saveSession(session: SessionData): void {
  const storage = session.remember_me ? localStorage : sessionStorage
  storage.setItem('session', JSON.stringify(session))
}

export function getSession(): SessionData | null {
  // ã¾ãšsessionStorageã‚’ãƒã‚§ãƒƒã‚¯
  let sessionData = sessionStorage.getItem('session')
  if (!sessionData) {
    // ãªã‘ã‚Œã°localStorageã‚’ãƒã‚§ãƒƒã‚¯
    sessionData = localStorage.getItem('session')
  }

  if (!sessionData) return null

  try {
    const session: SessionData = JSON.parse(sessionData)
    
    // æœŸé™ãƒã‚§ãƒƒã‚¯
    if (Date.now() > session.expires_at) {
      clearSession()
      return null
    }

    return session
  } catch {
    clearSession()
    return null
  }
}

export function clearSession(): void {
  sessionStorage.removeItem('session')
  localStorage.removeItem('session')
}

export function isSessionValid(): boolean {
  const session = getSession()
  return session !== null
}
```

#### 4. èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `contexts/AuthContext.tsx`
```typescript
'use client'

import { createContext, useContext, useState, useEffect } from 'react'
import { User, AuthState, LoginCredentials } from '@/types/auth'
import { authenticate, logout } from '@/lib/auth'
import { getSession, saveSession, createSession, clearSession } from '@/lib/session'

interface AuthContextType extends AuthState {
  login: (credentials: LoginCredentials) => Promise<void>
  logout: () => Promise<void>
}

const AuthContext = createContext<AuthContextType | undefined>(undefined)

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [authState, setAuthState] = useState<AuthState>({
    user: null,
    isLoading: true,
    isAuthenticated: false
  })

  // åˆæœŸåŒ–
  useEffect(() => {
    const session = getSession()
    if (session) {
      setAuthState({
        user: session.user,
        isLoading: false,
        isAuthenticated: true
      })
    } else {
      setAuthState(prev => ({ ...prev, isLoading: false }))
    }
  }, [])

  const login = async (credentials: LoginCredentials) => {
    try {
      setAuthState(prev => ({ ...prev, isLoading: true }))
      
      const user = await authenticate(credentials)
      if (!user) throw new Error('èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ')

      const session = createSession(user, credentials.remember_me)
      saveSession(session)

      setAuthState({
        user,
        isLoading: false,
        isAuthenticated: true
      })
    } catch (error) {
      setAuthState(prev => ({ ...prev, isLoading: false }))
      throw error
    }
  }

  const handleLogout = async () => {
    await logout()
    clearSession()
    setAuthState({
      user: null,
      isLoading: false,
      isAuthenticated: false
    })
  }

  return (
    <AuthContext.Provider value={{
      ...authState,
      login,
      logout: handleLogout
    }}>
      {children}
    </AuthContext.Provider>
  )
}

export function useAuth() {
  const context = useContext(AuthContext)
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider')
  }
  return context
}
```

#### 5. èªè¨¼ã‚¬ãƒ¼ãƒ‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `components/AuthGuard.tsx`
```typescript
'use client'

import { useEffect } from 'react'
import { useRouter, usePathname } from 'next/navigation'
import { useAuth } from '@/contexts/AuthContext'

// å¾“æ¥­å“¡ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãƒšãƒ¼ã‚¸
const EMPLOYEE_RESTRICTED_PAGES = [
  '/employee',      // å¾“æ¥­å“¡ç®¡ç†
  '/workplace',     // é…ç½®å ´æ‰€ç®¡ç†
  '/shiftPattern',  // ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†
  '/constraints'    // AIåˆ¶ç´„æ¡ä»¶ç®¡ç†
]

interface AuthGuardProps {
  children: React.ReactNode
}

export default function AuthGuard({ children }: AuthGuardProps) {
  const { user, isLoading, isAuthenticated } = useAuth()
  const router = useRouter()
  const pathname = usePathname()

  useEffect(() => {
    if (!isLoading) {
      // æœªèªè¨¼ã®å ´åˆã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      if (!isAuthenticated) {
        router.push('/login')
        return
      }

      // å¾“æ¥­å“¡ã®æ¨©é™ãƒã‚§ãƒƒã‚¯
      if (user?.role === 'employee' && EMPLOYEE_RESTRICTED_PAGES.includes(pathname)) {
        router.push('/') // ã‚·ãƒ•ãƒˆä½œæˆãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        return
      }
    }
  }, [isAuthenticated, isLoading, user, pathname, router])

  // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­
  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
      </div>
    )
  }

  // æœªèªè¨¼ã®å ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä¸­ï¼‰
  if (!isAuthenticated) {
    return null
  }

  return <>{children}</>
}
```

#### 6. ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
**ãƒ•ã‚¡ã‚¤ãƒ«**: `components/LoginForm.tsx`
```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { Lock, User, Eye, EyeOff } from 'lucide-react'
import { useAuth } from '@/contexts/AuthContext'
import { LoginCredentials } from '@/types/auth'
import { validateUserId, validatePassword } from '@/lib/auth'

export default function LoginForm() {
  const router = useRouter()
  const { login } = useAuth()
  
  const [formData, setFormData] = useState<LoginCredentials>({
    user_id: '',
    password: '',
    remember_me: false
  })
  
  const [showPassword, setShowPassword] = useState(false)
  const [errors, setErrors] = useState<Record<string, string>>({})
  const [isLoading, setIsLoading] = useState(false)

  const validateForm = (): boolean => {
    const newErrors: Record<string, string> = {}

    if (!formData.user_id) {
      newErrors.user_id = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
    } else if (!validateUserId(formData.user_id)) {
      newErrors.user_id = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¯å°æ–‡å­—5æ–‡å­—+æ•°å­—3æ¡ã§å…¥åŠ›ã—ã¦ãã ã•ã„'
    }

    if (!formData.password) {
      newErrors.password = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
    } else if (!validatePassword(formData.password)) {
      newErrors.password = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å°æ–‡å­—5æ–‡å­—+æ•°å­—3æ¡ã§å…¥åŠ›ã—ã¦ãã ã•ã„'
    }

    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    if (!validateForm()) return

    setIsLoading(true)
    try {
      await login(formData)
      router.push('/') // ã‚·ãƒ•ãƒˆä½œæˆãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    } catch (error) {
      setErrors({ submit: error instanceof Error ? error.message : 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ' })
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex items-center justify-center p-4">
      <div className="w-full max-w-md">
        <div className="bg-white rounded-2xl shadow-xl p-8">
          <div className="text-center mb-8">
            <div className="w-16 h-16 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
              <Lock className="w-8 h-8 text-white" />
            </div>
            <h1 className="text-2xl font-bold text-gray-800">ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p className="text-gray-600 mt-2">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</p>
          </div>

          <form onSubmit={handleSubmit} className="space-y-6">
            {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ID */}
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
              </label>
              <div className="relative">
                <User className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
                <input
                  type="text"
                  value={formData.user_id}
                  onChange={(e) => setFormData(prev => ({ ...prev, user_id: e.target.value.toLowerCase() }))}
                  className={`w-full pl-10 pr-4 py-3 border-2 rounded-xl focus:ring-2 focus:ring-indigo-200 transition-colors ${
                    errors.user_id ? 'border-red-300 focus:border-red-500' : 'border-gray-200 focus:border-indigo-500'
                  }`}
                  placeholder="ä¾‹: tanaka123"
                  maxLength={8}
                  disabled={isLoading}
                />
              </div>
              {errors.user_id && <p className="text-red-500 text-sm mt-1">{errors.user_id}</p>}
            </div>

            {/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ */}
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={formData.password}
                  onChange={(e) => setFormData(prev => ({ ...prev, password: e.target.value }))}
                  className={`w-full pl-10 pr-12 py-3 border-2 rounded-xl focus:ring-2 focus:ring-indigo-200 transition-colors ${
                    errors.password ? 'border-red-300 focus:border-red-500' : 'border-gray-200 focus:border-indigo-500'
                  }`}
                  placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
                  maxLength={8}
                  disabled={isLoading}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                  disabled={isLoading}
                >
                  {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                </button>
              </div>
              {errors.password && <p className="text-red-500 text-sm mt-1">{errors.password}</p>}
            </div>

            {/* ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿æŒ */}
            <div className="flex items-center">
              <input
                type="checkbox"
                id="remember_me"
                checked={formData.remember_me}
                onChange={(e) => setFormData(prev => ({ ...prev, remember_me: e.target.checked }))}
                className="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                disabled={isLoading}
              />
              <label htmlFor="remember_me" className="ml-2 text-sm text-gray-700">
                ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ï¼ˆ2é€±é–“ï¼‰
              </label>
            </div>

            {/* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
            {errors.submit && (
              <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                <p className="text-red-700 text-sm">{errors.submit}</p>
              </div>
            )}

            {/* ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ */}
            <button
              type="submit"
              disabled={isLoading}
              className="w-full py-3 px-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-400 text-white rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 disabled:transform-none"
            >
              {isLoading ? 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...' : 'ãƒ­ã‚°ã‚¤ãƒ³'}
            </button>
          </form>

          {/* ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± */}
          <div className="mt-6 p-4 bg-gray-50 rounded-lg">
            <p className="text-xs text-gray-600 mb-2">ãƒ‡ãƒ¢ç”¨ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±:</p>
            <div className="text-xs space-y-1">
              <div>ç®¡ç†è€…: admin123 / admin123</div>
              <div>å¾“æ¥­å“¡: nurse456 / nurse456</div>
              <div>é–‹ç™ºè€…: devel789 / devel789</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}
```

#### 7. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/login/page.tsx`
```typescript
import LoginForm from '@/components/LoginForm'

export default function LoginPage() {
  return <LoginForm />
}
```

### Phase 2: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´

#### 1. app/layout.tsxå¤‰æ›´
**å¤‰æ›´å†…å®¹**: AuthProviderã§ãƒ©ãƒƒãƒ—
```typescript
import type { Metadata } from 'next'
import './globals.css'
import { AuthProvider } from '@/contexts/AuthContext'

export const metadata: Metadata = {
  title: 'ãƒ¡ãƒ‡ã‚£æ§˜å°‚ç”¨ã‚·ãƒ•ãƒˆä½œæˆãƒ„ãƒ¼ãƒ«',
  description: 'AIã‚’æ´»ç”¨ã—ãŸåŒ»ç™‚æ©Ÿé–¢å‘ã‘ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="ja">
      <body className="font-sans antialiased">
        <AuthProvider>
          {children}
        </AuthProvider>
      </body>
    </html>
  )
}
```

#### 2. app/page.tsxå¤‰æ›´
**å¤‰æ›´å†…å®¹**: èªè¨¼ãƒã‚§ãƒƒã‚¯è¿½åŠ 
```typescript
'use client'

import { useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { useAuth } from '@/contexts/AuthContext'
import AuthGuard from '@/components/AuthGuard'
import MainLayout from '@/components/MainLayout'

export default function HomePage() {
  const { isAuthenticated, isLoading } = useAuth()
  const router = useRouter()

  useEffect(() => {
    // èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    if (!isLoading && !isAuthenticated) {
      router.push('/login')
    }
  }, [isAuthenticated, isLoading, router])

  // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã¾ãŸã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä¸­
  if (isLoading || !isAuthenticated) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
      </div>
    )
  }

  return (
    <AuthGuard>
      <MainLayout />
    </AuthGuard>
  )
}
```

#### 3. components/MainLayout.tsxå¤‰æ›´
**å¤‰æ›´å†…å®¹**: æ¨©é™ç®¡ç†ã¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½è¿½åŠ 

```typescript
// æ—¢å­˜ã®importã«è¿½åŠ 
import { useAuth } from '@/contexts/AuthContext'
import { LogOut } from 'lucide-react'
import type { UserRole } from '@/types/auth'

// æ¨©é™ã«å¿œã˜ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–¢æ•°ã‚’è¿½åŠ 
const getFilteredMenuItems = (userRole: UserRole): MenuItem[] => {
  const allMenuItems: MenuItem[] = [
    {
      id: 'dataInput',
      icon: <Rocket className="w-5 h-5" />,
      title: 'ã‚·ãƒ•ãƒˆä½œæˆ',
      description: 'ç®¡ç†æ©Ÿèƒ½ã‚«ãƒ¼ãƒ‰ã€AIä½œæˆé–‹å§‹'
    },
    {
      id: 'employee',
      icon: <Users className="w-5 h-5" />,
      title: 'å¾“æ¥­å“¡ç®¡ç†',
      description: 'åŸºæœ¬æƒ…å ±ã€å¯¾å¿œå¯èƒ½é…ç½®'
    },
    {
      id: 'workplace',
      icon: <MapPin className="w-5 h-5" />,
      title: 'é…ç½®å ´æ‰€ç®¡ç†',
      description: 'AM/PMåˆ†å‰²ã€14ç®‡æ‰€è¨­å®š'
    },
    {
      id: 'shiftPattern',
      icon: <Clock className="w-5 h-5" />,
      title: 'ã‚·ãƒ•ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†',
      description: 'å‹¤å‹™æ™‚é–“å¸¯ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç™»éŒ²'
    },
    {
      id: 'leave',
      icon: <Calendar className="w-5 h-5" />,
      title: 'å¸Œæœ›ä¼‘ç®¡ç†',
      description: 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼/ãƒªã‚¹ãƒˆè¡¨ç¤º'
    },
    {
      id: 'constraints',
      icon: <Bot className="w-5 h-5" />,
      title: 'AIåˆ¶ç´„æ¡ä»¶ç®¡ç†',
      description: 'è‡ªç„¶è¨€èªã§ã®åˆ¶ç´„è¨­å®š'
    },
    {
      id: 'shift',
      icon: <ClipboardList className="w-5 h-5" />,
      title: 'ã‚·ãƒ•ãƒˆè¡¨ç¤º',
      description: 'ã€AMã€‘/ã€PMã€‘è¡¨ç¤ºã€ç·¨é›†'
    }
  ]
  
  if (userRole === 'employee') {
    // å¾“æ¥­å“¡ã¯ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    return allMenuItems.filter(item => 
      ['dataInput', 'leave', 'shift'].includes(item.id)
    )
  }
  
  // ç®¡ç†è€…ãƒ»é–‹ç™ºè€…ã¯å…¨ã¦ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
  return allMenuItems
}

// MainLayouté–¢æ•°å†…ã§ä»¥ä¸‹ã‚’å¤‰æ›´
export default function MainLayout({ children }: LayoutProps) {
  const [isCollapsed, setIsCollapsed] = useState(false)
  const [currentPage, setCurrentPage] = useState<PageType>('dataInput')
  
  // èªè¨¼æƒ…å ±ã‚’å–å¾—
  const { user, logout } = useAuth()

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆèªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å–å¾—ï¼‰
  const userInfo = {
    name: user?.name || 'åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼',
    role: user?.role || 'employee',
    avatar: user?.role === 'admin' ? 'ğŸ‘‘' : user?.role === 'developer' ? 'ğŸ”§' : 'ğŸ‘¤'
  }

  // æ¨©é™ã«å¿œã˜ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®
  const menuItems = user ? getFilteredMenuItems(user.role) : []

  // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
  const handleLogout = async () => {
    if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
      await logout()
    }
  }

  // ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚’è¿½åŠ 
  const systemItems = [
    { icon: <BookOpen className="w-4 h-4" />, title: 'æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«' },
    { icon: <HelpCircle className="w-4 h-4" />, title: 'ãƒ˜ãƒ«ãƒ—ãƒ»ã‚µãƒãƒ¼ãƒˆ' },
    { icon: <Download className="w-4 h-4" />, title: 'ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ' },
    { 
      icon: <LogOut className="w-4 h-4" />, 
      title: 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ',
      onClick: handleLogout
    }
  ]

  // æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¯åŸºæœ¬çš„ã«ãã®ã¾ã¾
  // systemItemsã®ãƒãƒƒãƒ—éƒ¨åˆ†ã§onClickå‡¦ç†ã‚’è¿½åŠ 
  {systemItems.map((item, index) => (
    <li key={index}>
      <button
        onClick={item.onClick || (() => {})}
        className="w-full flex items-center gap-3 px-3 py-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors text-left"
      >
        {item.icon}
        {!isCollapsed && <span className="text-sm">{item.title}</span>}
      </button>
    </li>
  ))}
```

#### 4. types/index.tså¤‰æ›´
**å¤‰æ›´å†…å®¹**: UserRoleå‹ã‚’è¿½åŠ 
```typescript
// æ—¢å­˜ã®å†…å®¹ã«ä»¥ä¸‹ã‚’è¿½åŠ 
export type UserRole = 'admin' | 'employee' | 'developer'

// æ—¢å­˜ã®User interfaceã‚’æ›´æ–°ï¼ˆã‚‚ã—å­˜åœ¨ã™ã‚‹å ´åˆï¼‰
export interface User {
  id: string
  name: string
  role: UserRole
  avatar: string
  // ãã®ä»–ã®æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
}
```

## ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿

### ãƒ¢ãƒƒã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰
1. **ç®¡ç†è€…**: `admin123` / `admin123`
2. **å¾“æ¥­å“¡**: `nurse456` / `nurse456`  
3. **é–‹ç™ºè€…**: `devel789` / `devel789`

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] `types/auth.ts` - èªè¨¼é–¢é€£å‹å®šç¾©
- [ ] `lib/auth.ts` - èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯
- [ ] `lib/session.ts` - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- [ ] `contexts/AuthContext.tsx` - èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- [ ] `components/AuthGuard.tsx` - èªè¨¼ã‚¬ãƒ¼ãƒ‰
- [ ] `components/LoginForm.tsx` - ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
- [ ] `app/login/page.tsx` - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸

### Phase 2: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´
- [ ] `app/layout.tsx` - AuthProviderã§ãƒ©ãƒƒãƒ—
- [ ] `app/page.tsx` - èªè¨¼ãƒã‚§ãƒƒã‚¯è¿½åŠ 
- [ ] `components/MainLayout.tsx` - æ¨©é™ç®¡ç†ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½è¿½åŠ 
- [ ] `types/index.ts` - UserRoleå‹è¿½åŠ 

### Phase 3: å‹•ä½œç¢ºèª
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸è¡¨ç¤ºç¢ºèª
- [ ] å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¨®åˆ¥ã§ã®ãƒ­ã‚°ã‚¤ãƒ³å‹•ä½œç¢ºèª
- [ ] æ¨©é™ã«ã‚ˆã‚‹ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ç¢ºèª
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆä¿æŒãƒ»æœŸé™ï¼‰ç¢ºèª
- [ ] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ç¢ºèª
- [ ] ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºç¢ºèª

## å°†æ¥å®Ÿè£…äºˆå®š

### Supabaseé€£æºæ™‚ã®å¤‰æ›´ç‚¹
1. `lib/auth.ts` - ãƒ¢ãƒƒã‚¯èªè¨¼ã‚’å®Ÿéš›ã®Supabaseèªè¨¼ã«å¤‰æ›´
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆãƒ»ç®¡ç†
3. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®APIé€£æº

### ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œæ™‚ã®å¤‰æ›´ç‚¹
1. ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ
2. ãƒ†ãƒŠãƒ³ãƒˆé¸æŠæ©Ÿèƒ½è¿½åŠ 
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«tenant_idè¿½åŠ 
4. èªè¨¼ãƒ•ãƒ­ãƒ¼ã«ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±çµ„ã¿è¾¼ã¿

## æ³¨æ„äº‹é …

1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ç¾åœ¨ã¯ãƒ¢ãƒƒã‚¯å®Ÿè£…ã®ãŸã‚ã€æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšSupabaseç­‰ã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨
2. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: ç¾åœ¨ã¯å¹³æ–‡ä¿å­˜ã€æœ¬ç•ªã§ã¯å¿…ãšãƒãƒƒã‚·ãƒ¥åŒ–
3. **ã‚»ãƒƒã‚·ãƒ§ãƒ³**: ãƒ–ãƒ©ã‚¦ã‚¶ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨ã€æœ¬ç•ªã§ã¯ã‚ˆã‚Šã‚»ã‚­ãƒ¥ã‚¢ãªæ–¹æ³•ã‚’æ¤œè¨
4. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã¿ã€æœ¬ç•ªã§ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã‚‚å®Ÿè£…
5. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åŸºæœ¬çš„ãªã‚‚ã®ã®ã¿ã€æœ¬ç•ªã§ã¯è©³ç´°ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒå¿…è¦

## å®Œäº†åŸºæº–

ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®ãŒå®Œäº†ã—ã€ä»¥ä¸‹ã®å‹•ä½œãŒç¢ºèªã§ãã‚‹ã“ã¨ï¼š
1. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã§ã®èªè¨¼
2. æ¨©é™ã«å¿œã˜ãŸãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆæ™‚é–“ãƒ»ä¿æŒæ©Ÿèƒ½ï¼‰
4. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
5. ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ

å®Ÿè£…å®Œäº†å¾Œã¯æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆSupabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºï¼‰ã«é€²ã‚€äºˆå®šã€‚